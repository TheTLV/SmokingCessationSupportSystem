<Window
    x:Class="WPFApp.Views.AchievementView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="clr-namespace:WPFApp.Converters"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="Thành Tựu Cai Thuốc"
    Width="1000"
    Height="700"
    FontFamily="Segoe UI"
    WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <conv:BoolToColorConverter x:Key="BoolToColorConverter" />
        <conv:BoolToOpacityConverter x:Key="BoolToOpacityConverter" />
        <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />

        <!--  Color Palette  -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#4CAF50" />
        <SolidColorBrush x:Key="SecondaryColor" Color="#8BC34A" />
        <SolidColorBrush x:Key="DarkTextColor" Color="#212121" />
        <SolidColorBrush x:Key="LightTextColor" Color="#757575" />

        <!--  Gradient Brush  -->
        <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Offset="0" Color="#4CAF50" />
            <GradientStop Offset="1" Color="#8BC34A" />
        </LinearGradientBrush>

        <!--  Card Style  -->
        <Style x:Key="AchievementCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect
                        BlurRadius="15"
                        ShadowDepth="3"
                        Color="#10000000" />
                </Setter.Value>
            </Setter>
            <Setter Property="Margin" Value="10" />
            <Setter Property="Width" Value="200" />
            <Setter Property="Height" Value="250" />
            <!--  Tăng chiều cao để chứa nút chia sẻ  -->
        </Style>

        <!--  Badge Style  -->
        <Style x:Key="UnlockedBadgeStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource PrimaryGradient}" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="VerticalAlignment" Value="Top" />
            <Setter Property="Margin" Value="10" />
        </Style>

        <!--  Progress Style  -->
        <Style x:Key="ProgressBarStyle" TargetType="ProgressBar">
            <Setter Property="Height" Value="8" />
            <Setter Property="Margin" Value="0,10" />
            <Setter Property="Foreground" Value="{StaticResource PrimaryGradient}" />
        </Style>

        <Style
            x:Key="BackButtonStyle"
            BasedOn="{StaticResource MaterialDesignFlatButton}"
            TargetType="Button">
            <Setter Property="Width" Value="120" />
            <Setter Property="Height" Value="36" />
            <Setter Property="Margin" Value="0,0,10,0" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="Background" Value="Transparent" />
        </Style>

        <!--  Share Button Style  -->
        <Style
            x:Key="ShareButtonStyle"
            BasedOn="{StaticResource MaterialDesignOutlinedButton}"
            TargetType="Button">
            <Setter Property="Width" Value="120" />
            <Setter Property="Height" Value="30" />
            <Setter Property="Margin" Value="0,10,0,0" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="Foreground" Value="#1976D2" />
            <Setter Property="BorderBrush" Value="#1976D2" />
        </Style>
    </Window.Resources>

    <Grid Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <Border
            Grid.Row="0"
            Padding="20"
            Background="{StaticResource PrimaryGradient}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--  Back Button  -->
                <Button
                    Grid.Column="0"
                    Click="BackButton_Click"
                    Command="{Binding BackCommand}"
                    Style="{StaticResource BackButtonStyle}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon
                            Width="24"
                            Height="24"
                            Kind="ArrowLeft" />
                        <TextBlock
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            Text="Quay lại" />
                    </StackPanel>
                </Button>

                <!--  Title  -->
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock
                        FontSize="24"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="THÀNH TỰU CAI THUỐC" />
                    <TextBlock
                        Margin="0,5,0,0"
                        FontSize="14"
                        Foreground="#EEFFFFFF"
                        Text="Các mốc quan trọng trên hành trình của bạn" />
                </StackPanel>
            </Grid>
        </Border>

        <!--  Main Content  -->
        <ScrollViewer
            Grid.Row="1"
            Padding="20"
            VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Achievements}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource AchievementCardStyle}">
                            <Grid>
                                <!--  Badge for unlocked achievements  -->
                                <Border Style="{StaticResource UnlockedBadgeStyle}" Visibility="{Binding IsUnlocked, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock
                                        FontSize="10"
                                        FontWeight="Bold"
                                        Foreground="White"
                                        Text="ĐÃ ĐẠT" />
                                </Border>

                                <StackPanel Margin="15" VerticalAlignment="Center">
                                    <!--  Achievement Icon  -->
                                    <Viewbox Height="60" Margin="0,0,0,10">
                                        <materialDesign:PackIcon
                                            Foreground="{Binding IsUnlocked, Converter={StaticResource BoolToColorConverter}}"
                                            Kind="{Binding IconKind}"
                                            Opacity="{Binding IsUnlocked, Converter={StaticResource BoolToOpacityConverter}}" />
                                    </Viewbox>

                                    <!--  Achievement Title  -->
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="16"
                                        FontWeight="SemiBold"
                                        Foreground="{StaticResource DarkTextColor}"
                                        Text="{Binding Title}"
                                        TextWrapping="Wrap" />

                                    <!--  Achievement Description  -->
                                    <TextBlock
                                        Margin="0,5,0,0"
                                        HorizontalAlignment="Center"
                                        FontSize="12"
                                        Foreground="{StaticResource LightTextColor}"
                                        Text="{Binding Description}"
                                        TextWrapping="Wrap" />

                                    <!--  Share Button (only show when unlocked)  -->
                                    <Button
                                        Command="{Binding DataContext.ShareAchievementCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource ShareButtonStyle}"
                                        Visibility="{Binding IsUnlocked, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon
                                                Width="16"
                                                Height="16"
                                                Margin="0,0,5,0"
                                                Kind="ShareVariant" />
                                            <TextBlock Text="Chia sẻ" />
                                        </StackPanel>
                                    </Button>

                                    <!--  Progress for upcoming achievements  -->
                                    <StackPanel Visibility="{Binding IsUnlocked, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="11"
                                            Foreground="{StaticResource LightTextColor}"
                                            Text="{Binding ProgressText}" />
                                        <ProgressBar
                                            Maximum="{Binding Target}"
                                            Style="{StaticResource ProgressBarStyle}"
                                            Value="{Binding Progress}" />
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Window>